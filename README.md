# docker-interlok-template [![check](https://github.com/adaptris-labs/docker-interlok-template/actions/workflows/gradle.yaml/badge.svg)](https://github.com/adaptris-labs/docker-interlok-template/actions/workflows/gradle.yaml)

Just a simple template for building an Docker image using gradle via [Google Jib](https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin) under the covers to do the build.

_What you're effectively doing is defining the Dockerfile inside your build.gradle for the purposes of Jib. This might not make sense in all cases because you're not just doing Java and learning multiple ways to define an image isn't on your list of great ideas._


## TLDR

- Modify build.gradle to include the optional components you require
- The UI isn't part of the image.
- Add your custom config to src/main/interlok/config/ as required
- `./gradlew jibDockerBuild` which should eventually create you a docker image.
- `docker run -it --rm "$(whoami)/interlok:latest"`

## Key Takeaways

Since Jib assumes that you're a java project with a compile step, and interlok isn't quite like that (unless you have custom code) we're actually slightly deviating from expectations. The layout of the image is slightly different to the standard `interlok-base` image and tries to confirm to the Jib convention of putting everything into `/app`

- We actually override the default entrypoint that would be generated by Jib since the generated _jib-classpath-file_ ends up being truncated (to 4k) so it isn't quite fit for purpose.
  - You could opt to build an uber-jar out of all the jars; try using the [shadow plugin](https://github.com/johnrengelman/shadow).
- The resulting file structure is something like this.
```
- /app
    | - config // sourced from src/main/interlok
    | - libs // generated by Jib
    | - classpath // generated by Jib (with the artefact from the jar task, so effectively ignored)
```
- Your base image needs to have the user created if you don't want to run as _root_, specifying the _user_ inside build.gradle simply breaks you when you try to run the image.